{% extends "admin/base_admin.html" %}

{% block title %}Manage Registration Fees - Admin Dashboard{% endblock %}

{% block content %}
<div class="admin-section">
    <h1>Manage Registration Fees</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="admin-form-container">
        <form method="POST" class="registration-fees-form">
            <!-- Early Bird Registration -->
            <div class="form-section">
                <h2>Early Bird Registration</h2>
                <div class="form-group">
                    <label for="early_bird_deadline">Deadline</label>
                    <input type="date" id="early_bird_deadline" name="early_bird_deadline" value="{{ fees.early_bird.deadline if fees and fees.early_bird else '' }}">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="early_bird_student">Authors (Students)</label>
                        <input type="number" id="early_bird_student" name="early_bird_student" value="{{ fees.early_bird.student_author if fees and fees.early_bird else '' }}" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="early_bird_regular">Authors (Regular)</label>
                        <input type="number" id="early_bird_regular" name="early_bird_regular" value="{{ fees.early_bird.regular_author if fees and fees.early_bird else '' }}" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="early_bird_listener">Listener</label>
                        <input type="number" id="early_bird_listener" name="early_bird_listener" value="{{ fees.early_bird.listener if fees and fees.early_bird else '' }}" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="early_bird_virtual">Virtual Delegate</label>
                        <input type="number" id="early_bird_virtual" name="early_bird_virtual" value="{{ fees.early_bird.virtual if fees and fees.early_bird else '' }}" step="0.01">
                    </div>
                </div>
            </div>

            <!-- Early Registration -->
            <div class="form-section">
                <h2>Early Registration</h2>
                <div class="form-group">
                    <label for="early_deadline">Deadline</label>
                    <input type="date" id="early_deadline" name="early_deadline" value="{{ fees.early.deadline if fees and fees.early else '' }}">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="early_student">Authors (Students)</label>
                        <input type="number" id="early_student" name="early_student" value="{{ fees.early.student_author if fees and fees.early else '' }}" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="early_regular">Authors (Regular)</label>
                        <input type="number" id="early_regular" name="early_regular" value="{{ fees.early.regular_author if fees and fees.early else '' }}" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="early_listener">Listener</label>
                        <input type="number" id="early_listener" name="early_listener" value="{{ fees.early.listener if fees and fees.early else '' }}" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="early_virtual">Virtual Delegate</label>
                        <input type="number" id="early_virtual" name="early_virtual" value="{{ fees.early.virtual if fees and fees.early else '' }}" step="0.01">
                    </div>
                </div>
            </div>

            <!-- Late Registration -->
            <div class="form-section">
                <h2>Late Registration</h2>
                <div class="form-group">
                    <label for="late_deadline">Deadline</label>
                    <input type="date" id="late_deadline" name="late_deadline" value="{{ fees.late.deadline if fees and fees.late else '' }}">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="late_student">Authors (Students)</label>
                        <input type="number" id="late_student" name="late_student" value="{{ fees.late.student_author if fees and fees.late else '' }}" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="late_regular">Authors (Regular)</label>
                        <input type="number" id="late_regular" name="late_regular" value="{{ fees.late.regular_author if fees and fees.late else '' }}" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="late_listener">Listener</label>
                        <input type="number" id="late_listener" name="late_listener" value="{{ fees.late.listener if fees and fees.late else '' }}" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="late_virtual">Virtual Delegate</label>
                        <input type="number" id="late_virtual" name="late_virtual" value="{{ fees.late.virtual if fees and fees.late else '' }}" step="0.01">
                    </div>
                </div>
            </div>

            <!-- Additional Fees -->
            <div class="form-section">
                <h2>Additional Fees</h2>
                <div class="form-group">
                    <label for="extra_paper_fee">Extra Paper Fee</label>
                    <input type="number" id="extra_paper_fee" name="extra_paper_fee" value="{{ fees.extra_paper_fee if fees else '' }}" step="0.01">
                </div>
            </div>

            <!-- Registration Includes -->
            <div class="form-section">
                <h2>Registration Includes</h2>
                <div class="dynamic-list" id="registration-includes">
                    {% if fees and fees.includes %}
                        {% for item in fees.includes %}
                            <div class="list-item">
                                <input type="text" name="registration_includes" value="{{ item }}">
                                <button type="button" class="btn-remove">Remove</button>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="list-item">
                            <input type="text" name="registration_includes" placeholder="e.g., Conference Programme Booklet">
                            <button type="button" class="btn-remove">Remove</button>
                        </div>
                    {% endif %}
                </div>
                <button type="button" class="btn-add">Add Item</button>
            </div>

            <!-- Payment Details -->
            <div class="form-section">
                <h2>Payment Details</h2>
                <div class="form-group">
                    <label for="beneficiary">Beneficiary Name</label>
                    <input type="text" id="beneficiary" name="beneficiary" value="{{ fees.payment_details.beneficiary if fees and fees.payment_details else '' }}">
                </div>
                <div class="form-group">
                    <label for="iban">IBAN</label>
                    <input type="text" id="iban" name="iban" value="{{ fees.payment_details.iban if fees and fees.payment_details else '' }}">
                </div>
                <div class="form-group">
                    <label for="bic">BIC</label>
                    <input type="text" id="bic" name="bic" value="{{ fees.payment_details.bic if fees and fees.payment_details else '' }}">
                </div>
                <div class="form-group">
                    <label for="beneficiary_address">Beneficiary Address</label>
                    <input type="text" id="beneficiary_address" name="beneficiary_address" value="{{ fees.payment_details.beneficiary_address if fees and fees.payment_details else '' }}">
                </div>
                <div class="form-group">
                    <label for="bank_name">Bank Name</label>
                    <input type="text" id="bank_name" name="bank_name" value="{{ fees.payment_details.bank_name if fees and fees.payment_details else '' }}">
                </div>
                <div class="form-group">
                    <label for="bank_address">Bank Address</label>
                    <input type="text" id="bank_address" name="bank_address" value="{{ fees.payment_details.bank_address if fees and fees.payment_details else '' }}">
                </div>
                <div class="form-group">
                    <label for="intermediary_bic">Intermediary BIC</label>
                    <input type="text" id="intermediary_bic" name="intermediary_bic" value="{{ fees.payment_details.intermediary_bic if fees and fees.payment_details else '' }}">
                </div>
                <div class="form-group">
                    <label for="contact_email">Contact Email</label>
                    <input type="email" id="contact_email" name="contact_email" value="{{ fees.payment_details.contact_email if fees and fees.payment_details else '' }}">
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-submit">Save Registration Fees</button>
                <a href="{{ url_for('registration') }}" class="btn-secondary">View Public Page</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle dynamic list for registration includes
    const includesList = document.querySelector('#registration-includes');
    const addBtn = includesList.nextElementSibling;

    addBtn.addEventListener('click', () => {
        const item = document.createElement('div');
        item.className = 'list-item';
        item.innerHTML = `
            <input type="text" name="registration_includes">
            <button type="button" class="btn-remove">Remove</button>
        `;
        includesList.appendChild(item);
    });

    includesList.addEventListener('click', e => {
        if (e.target.classList.contains('btn-remove')) {
            const items = includesList.querySelectorAll('.list-item');
            if (items.length > 1) {
                e.target.closest('.list-item').remove();
            }
        }
    });
});
</script>
{% endblock %} 