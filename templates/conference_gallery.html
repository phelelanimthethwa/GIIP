{% extends "user/base.html" %}

{% block title %}{{ conference.basic_info.name }} Gallery - GIIR{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <div class="header-content text-center">
            <h1 class="display-4">
                <i class="fas fa-images me-3"></i>
                {{ conference.basic_info.name }}
            </h1>
            <p class="lead">
                {% if conference.basic_info.year %}
                {{ conference.basic_info.year }} Conference Gallery
                {% else %}
                Conference Gallery
                {% endif %}
            </p>
            {% if conference.conference_code %}
            <div class="mt-2">
                <span class="badge bg-light text-dark fs-6 px-3 py-2">
                    <i class="fas fa-qrcode me-1"></i>
                    {{ conference.conference_code }}
                </span>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<div class="container py-5">
    <!-- Gallery Stats -->
    {% if images %}
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card bg-light">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-camera fa-2x text-primary me-3"></i>
                        <div>
                            <h5 class="mb-1">Gallery Overview</h5>
                            <p class="mb-0 text-muted">
                                {{ images|length }} image{{ images|length != 1 ? 's' : '' }} from this conference
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-primary text-white">
                <div class="card-body text-center">
                    <h3 class="mb-1">{{ images|length }}</h3>
                    <p class="mb-0">Photos</p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Gallery Grid -->
    {% if images %}
    <div class="gallery-grid">
        {% for image in images %}
        <div class="gallery-item">
            <a href="{{ image.url }}" data-lightbox="conference-gallery" data-title="{{ image.original_name }}">
                <img src="{{ image.url }}" alt="{{ image.original_name }}" loading="lazy">
                <div class="gallery-overlay">
                    <div class="gallery-info">
                        <i class="fas fa-search-plus"></i>
                    </div>
                </div>
            </a>
            <div class="gallery-caption">
                <small class="text-muted">{{ image.original_name }}</small>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5">
        <i class="fas fa-images fa-4x text-muted mb-3"></i>
        <h3>No Gallery Images Yet</h3>
        <p class="text-muted">Images will be available after this conference is completed.</p>
        <a href="{{ url_for('galleries') }}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left me-1"></i>
            Back to All Galleries
        </a>
    </div>
    {% endif %}

    <!-- Back Navigation -->
    {% if images %}
    <div class="text-center mt-5">
        <a href="{{ url_for('galleries') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i>
            Back to All Galleries
        </a>
    </div>
    {% endif %}
</div>

<!-- Lightbox CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css">

<style>
.gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
}

.gallery-item {
    position: relative;
    overflow: hidden;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.gallery-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.gallery-item img {
    width: 100%;
    height: 250px;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.gallery-item:hover img {
    transform: scale(1.05);
}

.gallery-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.gallery-item:hover .gallery-overlay {
    opacity: 1;
}

.gallery-info {
    color: white;
    font-size: 2rem;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.gallery-caption {
    padding: 1rem;
    background: white;
    text-align: center;
}

.gallery-caption small {
    font-size: 0.875rem;
    color: #666;
    display: block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Lightbox customizations */
.lightbox .lb-image {
    border-radius: 8px;
}

.lightbox .lb-nav a.lb-prev,
.lightbox .lb-nav a.lb-next {
    opacity: 0.8;
    transition: opacity 0.2s ease;
}

.lightbox .lb-nav a.lb-prev:hover,
.lightbox .lb-nav a.lb-next:hover {
    opacity: 1;
}

.lightbox .lb-caption {
    font-size: 1rem;
    line-height: 1.4;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .gallery-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1.5rem;
    }

    .gallery-item img {
        height: 200px;
    }
}

@media (max-width: 576px) {
    .gallery-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
}

/* Loading animation for images */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.gallery-item {
    animation: fadeIn 0.6s ease forwards;
}

.gallery-item:nth-child(1) { animation-delay: 0.1s; }
.gallery-item:nth-child(2) { animation-delay: 0.2s; }
.gallery-item:nth-child(3) { animation-delay: 0.3s; }
.gallery-item:nth-child(4) { animation-delay: 0.4s; }
.gallery-item:nth-child(5) { animation-delay: 0.5s; }
.gallery-item:nth-child(6) { animation-delay: 0.6s; }
</style>

<!-- Lightbox JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>

<script>
$(document).ready(function() {
    // Initialize lightbox
    lightbox.option({
        'resizeDuration': 200,
        'wrapAround': true,
        'albumLabel': '{{ conference.basic_info.name }} Gallery - Image %1 of %2',
        'fadeDuration': 300,
        'imageFadeDuration': 300
    });

    // Add loading states for images
    $('.gallery-item img').each(function() {
        $(this).on('load', function() {
            $(this).addClass('loaded');
        }).on('error', function() {
            $(this).closest('.gallery-item').html(`
                <div class="d-flex align-items-center justify-content-center h-100 bg-light text-muted">
                    <div class="text-center">
                        <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                        <p class="small mb-0">Image unavailable</p>
                    </div>
                </div>
            `);
        });
    });

    // Add click tracking for analytics (optional)
    $('.gallery-item a').click(function() {
        const imageName = $(this).find('img').attr('alt');
        console.log(`Gallery image viewed: ${imageName}`);
    });
});
</script>
{% endblock %}
